{% extends "base.html" %}
{% block content %}

<div class="card">
  <div class="card-head">
    <div>
      <h2 class="title">Identity Configuration</h2>
      <p class="muted">Subject Identifier: <b>{{ session.username }}</b></p>
    </div>

    <div class="pill">
      <span class="pill-label">Authorization State</span>
      <span class="pill-value">{{ role }}</span>
    </div>
  </div>

  <hr class="soft">

  <!-- Hidden by default; shown only when user types "admin" -->
  <div id="adminNotice" class="callout warn" style="display:none;">
    <div class="callout-title">Notice</div>
    <div class="callout-body">Admin role requests require special approval.</div>
  </div>

  {% if error %}
    <div class="callout danger">
      <div class="callout-title">Input rejected</div>
      <div class="callout-body">{{ error }}</div>
    </div>
  {% endif %}

  <div class="section">
    <h3 class="section-title">Authorization Adjustment</h3>
    <p class="muted">Submit a desired state for evaluation.</p>

    <form method="post" class="form">
      <label for="roleInput">Requested role</label>
      <input
        id="roleInput"
        type="text"
        name="role"
        placeholder="enter the required role"
        autocomplete="off"
        required
      >

      <button type="submit" class="btn">Submit for Evaluation</button>
      <p class="fineprint">Changes may not be reflected immediately.</p>
    </form>
  </div>
</div>

<script>
  (function () {
    const input = document.getElementById("roleInput");
    const notice = document.getElementById("adminNotice");

    const normalize = (s) => (s || "").trim().toLowerCase();

    function sync() {
      notice.style.display = (normalize(input.value) === "admin") ? "block" : "none";
    }

    input.addEventListener("input", sync);
    window.addEventListener("pageshow", sync);
    sync();
  })();
</script>

{% endblock %}
